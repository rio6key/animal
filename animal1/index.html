<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Kaijyu + Spider Scare (Adjusted Distance)</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  </head>
  <body>
    <a-scene>
      <!-- ç…§æ˜Ž -->
      <a-light type="ambient" color="#333"></a-light>
      <a-light type="directional" color="#999" position="2 4 3"></a-light>

      <!-- èƒŒæ™¯ï¼ˆ360Â°ç”»åƒï¼‰ -->
      <a-sky src="mori.jpg" rotation="0 -130 0"></a-sky>

      <!-- åŠ¹æžœéŸ³å†ç”Ÿç”¨ -->
      <a-entity id="sound-player"></a-entity>

      <!-- ã‚«ãƒ¡ãƒ© -->
      <a-entity id="cameraRig" position="0 -1 5">
        <a-camera look-controls></a-camera>
      </a-entity>

      <!-- ãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿ -->
      <a-assets>
        <a-asset-item id="kaijyu-asset" src="kaijyu.glb"></a-asset-item>
        <a-asset-item id="spider-asset" src="spider.glb"></a-asset-item>
      </a-assets>

      <!-- ðŸ¦– æ€ªç£ -->
      <a-entity
        id="kaijyu"
        gltf-model="#kaijyu-asset"
        position="0 -2.5 -10"
        rotation="0 0 0"
        scale="0.5 0.5 0.5"
        animation-mixer
        animation__move="property: position; to: 0 -2.5 5; dur: 25000; easing: linear; loop: false;"
      ></a-entity>

      <!-- ðŸ•·ï¸ èœ˜è››ï¼ˆè„…ã‹ã—ç”¨ï¼‰ -->
      <a-entity
        id="spider"
        gltf-model="#spider-asset"
        position="1 -1 18"
        scale="1.8 1.8 1.8"
        rotation="0 180 0"

        <!-- è¿‘ã¥ãè·é›¢ã‚’çŸ­ãï¼ˆé ã‚ã§æ­¢ã¾ã‚‹ï¼‰ -->
        animation__approach="property: position; to: 0 -0.8 10; dur: 3000; easing: linear; startEvents: scare;"
        animation__return="property: position; to: 1 -1 18; dur: 3000; easing: linear; startEvents: scare_return;"

        <!-- æ‹¡å¤§ã‚‚æŽ§ãˆã‚ã« -->
        animation__scale="property: scale; to: 2.3 2.3 2.3; dur: 3000; easing: linear; startEvents: scare;"
        animation__scale_return="property: scale; to: 1.8 1.8 1.8; dur: 3000; easing: linear; startEvents: scare_return;"
      ></a-entity>
    </a-scene>

    <script>
      // ðŸ¦– æ€ªç£ã‚’å°‘ã—æš—ã‚ã«
      const kaijyu = document.querySelector('#kaijyu');
      kaijyu.addEventListener('model-loaded', () => {
        kaijyu.object3D.traverse(node => {
          if (node.isMesh && node.material) node.material.color.multiplyScalar(0.6);
        });
        kaijyu.setAttribute('animation-mixer', 'clip: Walk; loop: repeat;');
      });

      // ðŸŽµ åŠ¹æžœéŸ³è¨­å®š
      const soundFiles = [
        "åŠ¹æžœéŸ³/hell_gear.mp3",
        "åŠ¹æžœéŸ³/susume.mp3",
        "åŠ¹æžœéŸ³/çªé¢¨ãŒå¹ã.mp3",
        "åŠ¹æžœéŸ³/é¢¨ãŒå¹ã1.mp3",
        "åŠ¹æžœéŸ³/é¢¨ãŒå¹ã2.mp3"
      ];

      const soundEntity = document.querySelector('#sound-player');

      function playRandomSound() {
        const file = soundFiles[Math.floor(Math.random() * soundFiles.length)];
        soundEntity.removeAttribute('sound');
        soundEntity.setAttribute('sound', {
          src: `url(${file})`,
          autoplay: true,
          volume: 1.0,
          loop: false
        });
        console.log("ðŸŽµ åŠ¹æžœéŸ³å†ç”Ÿ:", file);
      }

      // ðŸ•·ï¸ è„…ã‹ã—å‹•ä½œï¼ˆã‚¯ãƒªãƒƒã‚¯ã§ç™ºå‹•ï¼‰
      const spider = document.querySelector('#spider');
      window.addEventListener('click', () => {
        spider.emit('scare');       // èœ˜è››ãŒè¿‘ã¥ã
        playRandomSound();          // åŠ¹æžœéŸ³å†ç”Ÿ

        // å°‘ã—æ™‚é–“ã‚’ãŠã„ã¦æˆ»ã‚‹
        setTimeout(() => {
          spider.emit('scare_return');
        }, 3500); // å‹•ä½œ3ç§’ï¼‹ä½™è£•0.5ç§’
      });
    </script>
  </body>
</html>
